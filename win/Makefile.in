prefix = @prefix@
exec_prefix = @exec_prefix@

PATHTYPE=@PATHTYPE@
SRC_DIR = $(shell cygpath $(PATHTYPE) '@srcdir@')
GENERIC_DIR = $(shell cygpath $(PATHTYPE) '@srcdir@/../generic')
WIN_DIR = $(SRC_DIR)

@SET_MAKE@

# Macro that expands to the first dependency argument with the appropriate
# path type already resolved.

DEPARG = "$(shell cygpath $(PATHTYPE) $<)"

VPATH = "@srcdir@:@srcdir@/../generic:@srcdir@/../compat"

AR = @AR@
CC = @CC@
AC_FLAGS = @EXTRA_CFLAGS@ @DEFS@
CFLAGS_OPTIMIZE = @CFLAGS_OPTIMIZE@
CFLAGS_DEBUG = @CFLAGS_DEBUG@
CFLAGS_WARNING = @CFLAGS_WARNING@
CFLAGS = @CFLAGS@
CPPFLAGS = @CPPFLAGS@
LDFLAGS = @LDFLAGS@
EXEEXT = @EXEEXT@
OBJEXT = @OBJEXT@
SHLIB_LD = @SHLIB_LD@
SHLIB_LD_LIBS = @SHLIB_LD_LIBS@
SHLIB_CFLAGS = @SHLIB_CFLAGS@
SHLIB_SUFFIX = @SHLIB_SUFFIX@
TCL_DBGX = @TCL_DBGX@
VER=@TCL_MAJOR_VERSION@@TCL_MINOR_VERSION@
LIBS=@LIBS@

CC_SWITCHES = ${CFLAGS} ${CFLAGS_WARNING} ${TCL_SHLIB_CFLAGS} \
-I"${GENERIC_DIR}" -I"${SRC_DIR}" ${AC_FLAGS}

CC_OBJNAME = @CC_OBJNAME@
CC_EXENAME = @CC_EXENAME@

STUB_CC_SWITCHES = ${CFLAGS} ${CFLAGS_WARNING} ${SHLIB_CFLAGS} \
-I"${GENERIC_DIR}" -I"${SRC_DIR}" ${AC_FLAGS}


TCLSH_OBJS = tclAppInit.$(OBJEXT)

TCLTEST_OBJS = \
	tclTestInit.$(OBJEXT) \
	tclTest.$(OBJEXT) \
	tclTestObj.$(OBJEXT) \
	tclTestProcBodyObj.$(OBJEXT) \
	tclThreadTest.$(OBJEXT) \
	tclWinTest.$(OBJEXT)

GENERIC_OBJS = \
	regcomp.$(OBJEXT) \
	regexec.$(OBJEXT) \
	regfree.$(OBJEXT) \
	regerror.$(OBJEXT) \
	tclAlloc.$(OBJEXT) \
	tclAsync.$(OBJEXT) \
	tclBasic.$(OBJEXT) \
	tclBinary.$(OBJEXT) \
	tclCkalloc.$(OBJEXT) \
	tclClock.$(OBJEXT) \
	tclCmdAH.$(OBJEXT) \
	tclCmdIL.$(OBJEXT) \
	tclCmdMZ.$(OBJEXT) \
	tclCompCmds.$(OBJEXT) \
	tclCompExpr.$(OBJEXT) \
	tclCompile.$(OBJEXT) \
	tclDate.$(OBJEXT) \
	tclEncoding.$(OBJEXT) \
	tclEnv.$(OBJEXT) \
	tclEvent.$(OBJEXT) \
	tclExecute.$(OBJEXT) \
	tclFCmd.$(OBJEXT) \
	tclFileName.$(OBJEXT) \
	tclGet.$(OBJEXT) \
	tclHash.$(OBJEXT) \
	tclHistory.$(OBJEXT) \
	tclIndexObj.$(OBJEXT) \
	tclInterp.$(OBJEXT) \
	tclIO.$(OBJEXT) \
	tclIOCmd.$(OBJEXT) \
	tclIOSock.$(OBJEXT) \
	tclIOUtil.$(OBJEXT) \
	tclLink.$(OBJEXT) \
	tclLiteral.$(OBJEXT) \
	tclListObj.$(OBJEXT) \
	tclLoad.$(OBJEXT) \
	tclMain.$(OBJEXT) \
	tclNamesp.$(OBJEXT) \
	tclNotify.$(OBJEXT) \
	tclObj.$(OBJEXT) \
	tclPanic.$(OBJEXT) \
	tclParse.$(OBJEXT) \
	tclParseExpr.$(OBJEXT) \
	tclPipe.$(OBJEXT) \
	tclPkg.$(OBJEXT) \
	tclPosixStr.$(OBJEXT) \
	tclPreserve.$(OBJEXT) \
	tclProc.$(OBJEXT) \
	tclRegexp.$(OBJEXT) \
	tclResolve.$(OBJEXT) \
	tclResult.$(OBJEXT) \
	tclScan.$(OBJEXT) \
	tclStringObj.$(OBJEXT) \
	tclStubInit.$(OBJEXT) \
	tclStubLib.$(OBJEXT) \
	tclThread.$(OBJEXT) \
	tclTimer.$(OBJEXT) \
	tclUtf.$(OBJEXT) \
	tclUtil.$(OBJEXT) \
	tclVar.$(OBJEXT)

WIN_OBJS = \
	tclWin32Dll.$(OBJEXT) \
	tclWinChan.$(OBJEXT) \
	tclWinConsole.$(OBJEXT) \
	tclWinSerial.$(OBJEXT) \
	tclWinError.$(OBJEXT) \
	tclWinFCmd.$(OBJEXT) \
	tclWinFile.$(OBJEXT) \
	tclWinInit.$(OBJEXT) \
	tclWinLoad.$(OBJEXT) \
	tclWinMtherr.$(OBJEXT) \
	tclWinNotify.$(OBJEXT) \
	tclWinPipe.$(OBJEXT) \
	tclWinSock.$(OBJEXT) \
	tclWinThrd.$(OBJEXT) \
	tclWinTime.$(OBJEXT) 

COMPAT_OBJS = \
	strftime.$(OBJEXT)

TCL_OBJS = ${GENERIC_OBJS} ${WIN_OBJS} ${COMPAT_OBJS}

DDE_OBJS = tclWinDde.$(OBJEXT)

REG_OBJS = tclWinReg.$(OBJEXT)

STUB_OBJS = tclStubLib.$(OBJEXT)

TCLSH_OBJS = tclAppInit.$(OBJEXT)

TCLTEST_OBJS = \
	tclTest.$(OBJEXT) \
	tclTestObj.$(OBJEXT) \
	tclTestProcBodyObj.$(OBJEXT) \
	tclThreadTest.$(OBJEXT) \
	tclWinTest.$(OBJEXT) \
	testMain.$(OBJEXT)

##

DLLSUFFIX = @DLLSUFFIX@
LIBSUFFIX = @LIBSUFFIX@
EXESUFFIX = @EXESUFFIX@

STUB_LIB = tclstub$(VER)${LIBSUFFIX}
TCL_DLL = tcl$(VER)${DLLSUFFIX}
TCL_LIB = tcl$(VER)${LIBSUFFIX}
DDE_DLL = tcldde$(VER)${DLLSUFFIX}
DDE_LIB = tcldde$(VER)${LIBSUFFIX}
REG_DLL = tclreg$(VER)${DLLSUFFIX}
REG_LIB = tclreg$(VER)${LIBSUFFIX}

SHARED_LIBRARIES = $(TCL_DLL) $(DDE_DLL) $(REG_DLL)
STATIC_LIBRARIES = $(TCL_LIB) $(DDE_LIB) $(REG_LIB)

TCLSH = tclsh$(VER)${EXESUFFIX}
TCLTEST = tcltest${EXEEXT}

all: @LIBRARIES@ $(STATIC_LIBRARIES) $(STUB_LIB) $(TCLSH)

$(TCLSH): $(TCL_LIB) $(TCLSH_OBJS)
	$(CC) $(CFLAGS) $(TCLSH_OBJS) $(TCL_LIB) $(LIBS) $(CC_EXENAME) 

$(TCLTEST): $(TCL_LIB) $(TCLTEST_OBJS)
	$(CC) $(CFLAGS) $(TCLTEST_OBJS) $(TCL_LIB) $(LIBS) $(CC_EXENAME) 

# The following targets are configured by autoconf to generate either
# a shared library or static library

${STUB_LIB}: ${STUB_OBJS}
	@rm -f ${STUB_LIB}
	@MAKE_LIB@ ${STUB_OBJS}

${TCL_DLL}: ${TCL_OBJS}
	@rm -f ${TCL_DLL}
	@MAKE_DLL@ ${TCL_OBJS}

${TCL_LIB}: ${TCL_OBJS}
	@rm -f ${TCL_LIB}
	@MAKE_LIB@ ${TCL_OBJS}

${DDE_DLL}: ${DDE_OBJS} ${STUB_LIB}
	@rm -f ${DDE_DLL}
	@MAKE_DLL@ ${DDE_OBJS} ${STUB_LIB}

${DDE_LIB}: ${DDE_OBJS}
	@rm -f ${DDE_LIB}
	@MAKE_LIB@ ${DDE_OBJS}

${REG_DLL}: ${REG_OBJS} ${STUB_LIB}
	@rm -f ${REG_DLL}
	@MAKE_DLL@ ${REG_OBJS} ${STUB_LIB}

${REG_LIB}: ${REG_OBJS}
	@rm -f ${REG_LIB}
	@MAKE_LIB@ ${REG_OBJS}

# Add the object extension to the implicit rules.  By default .obj is not
# automatically added.

.SUFFIXES: .${OBJEXT}

# Special case object targets

tclWinInit.obj: tclWinInit.c
	$(CC) -c $(CC_SWITCHES) -DBUILD_tcl $(EXTFLAGS) $(DEPARG) $(CC_OBJNAME)

testMain.obj: tclAppInit.c
	$(CC) -c $(CC_SWITCHES) -DTCL_TEST $(DEPARG) $(CC_OBJNAME)

tclTest.obj: tclTest.c
	$(CC) -c $(CC_SWITCHES) $(DEPARG) $(CC_OBJNAME)

tclTestObj.obj: tclTestObj.c
	$(CC) -c $(CC_SWITCHES) $(DEPARG) $(CC_OBJNAME)

tclWinTest.obj: tclWinTest.c
	$(CC) -c $(CC_SWITCHES) $(DEPARG) $(CC_OBJNAME)

tclAppInit.obj : tclAppInit.c
	$(CC) -c $(CC_SWITCHES) $(DEPARG) $(CC_OBJNAME)

# The following objects should be built using the stub interfaces

tclWinReg.obj : tclWinReg.c
	$(CC) -c $(CC_SWITCHES) -DUSE_TCL_STUBS $(DEPARG) $(CC_OBJNAME)

tclWinDde.obj : tclWinDde.c
	$(CC) -c $(CC_SWITCHES) -DUSE_TCL_STUBS $(DEPARG) $(CC_OBJNAME)

# The following objects are part of the stub library and should not
# be built as DLL objects but none of the symbols should be exported

tclStubLib.${OBJEXT}: tclStubLib.c
	$(CC) -c $(CC_SWITCHES) -DSTATIC_BUILD $(DEPARG) $(CC_OBJNAME)


# Implicit rule for all object files that will end up in the Tcl library

.c.${OBJEXT}:
	$(CC) -c $(CC_SWITCHES) -DBUILD_tcl ${DEPARG} $(CC_OBJNAME)

Makefile: $(SRC_DIR)/Makefile.in
	config.status

clean:
	rm -f *.lib *.exp *.dll *.${OBJEXT} *~ \#* TAGS a.out
	rm -f $(TCLSH) $(TCLTEST)
	rm -f *.pch

distclean: clean
	rm -f Makefile config.status config.cache config.log
